@model catalogo_jogos.Models.Jogo
@{
    ViewData["Title"] = @Model.Name;

    // --- LÓGICA PARA CONVERTER O LINK DO YOUTUBE ---
    string videoEmbedUrl = null;
    if (!string.IsNullOrEmpty(Model.YoutubeUrl))
    {
        if (Model.YoutubeUrl.Contains("watch?v="))
        {
            videoEmbedUrl = Model.YoutubeUrl.Replace("watch?v=", "embed/");
        }
        else if (Model.YoutubeUrl.Contains("youtu.be/"))
        {
            videoEmbedUrl = Model.YoutubeUrl.Replace("youtu.be/", "www.youtube.com/embed/");
        }
        else if (Model.YoutubeUrl.Contains("/embed/"))
        {
            videoEmbedUrl = Model.YoutubeUrl; // Já está no formato correto
        }
    }

    // --- LÓGICA DAS DLCS ---
    bool hasDlcs = !string.IsNullOrEmpty(Model.DlcUrl1) ||
                   !string.IsNullOrEmpty(Model.DlcUrl2) ||
                   !string.IsNullOrEmpty(Model.DlcUrl3) ||
                   !string.IsNullOrEmpty(Model.DlcUrl4);

    bool hasMedia = !string.IsNullOrEmpty(videoEmbedUrl) || hasDlcs;

    // --- LÓGICA DOS FILTROS ---
    var termoBusca = Context.Request.Query["termoBusca"];
    var sortOrder = Context.Request.Query["sortOrder"];
    var filtroAno = Context.Request.Query["filtroAno"];
    var filtroNaoZerados = Context.Request.Query["filtroNaoZerados"];

    // =======================================
    // --- NOVA LÓGICA DE COR DA NOTA ---
    // =======================================
    string badgeColor;
    switch (Model.Grade)
    {
        case "Obra-Prima":
            badgeColor = "bg-warning text-dark"; // Dourado
            break;
        case "Excelente":
            badgeColor = "bg-success"; // Verde
            break;
        case "Muito Bom":
            badgeColor = "bg-primary"; // Azul
            break;
        case "Bom":
            badgeColor = "bg-info text-dark"; // Ciano
            break;
        case "Mediano":
            badgeColor = "bg-secondary"; // Cinza
            break;
        case "Ruim":
            badgeColor = "bg-danger"; // Vermelho
            break;
        case "Péssimo":
        case "Lixo Podre":
            badgeColor = "bg-dark"; // Preto
            break;
        default:
            badgeColor = "bg-light text-dark"; // Padrão
            break;
    }
}

<style>
    .game-cover-wrapper {
        max-width: 360px;
        margin: 0 auto;
    }

    .game-cover {
        width: 100%;
        height: auto;
        aspect-ratio: 3 / 4;
        object-fit: cover;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .dlc-image {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 15px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        cursor: pointer;
    }

    .modal-img {
        width: 100%;
        height: auto;
        border-radius: 8px;
    }

    .info-card {
        background-color: #f8f9fa;
    }

    .video-wrapper {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 */
        height: 0;
        overflow: hidden;
        max-width: 100%;
        background: #000;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        margin-bottom: 15px;
    }

        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
</style>

<div class="container mt-4 mb-5" style="max-width: 900px;">

    <div class="row">
        <div class="col-12 text-center">
            <h1 class="display-4 mb-4">@Model.Name</h1>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-10">

            <div class="card mb-4">
                <div class="card-body text-center p-3">
                    <div class="game-cover-wrapper">
                        @if (!string.IsNullOrEmpty(Model.CoverUrl))
                        {
                            <img src="@Model.CoverUrl" alt="Capa de @Model.Name" class="game-cover" />
                        }
                        else
                        {
                            <div class="alert alert-secondary m-0">Nenhuma capa cadastrada.</div>
                        }
                    </div>
                </div>
            </div>

            <div class="card mb-4 info-card">
                <div class="card-header text-center">
                    <h4>Informações</h4>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center info-card">
                        Ano Jogado/Terminado
                        <span class="fw-bold">@Model.Year</span>
                    </li>

                    <li class="list-group-item d-flex justify-content-between align-items-center info-card">
                        Nota
                        <span class="badge @badgeColor rounded-pill fs-6">@Model.Grade</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center info-card">
                        Terminado esse ano?
                        @if (Model.FinishedInThisYear)
                        {
                            <span class="fw-bold">Sim</span>
                        }
                        else
                        {
                            <span class="fw-bold">Não</span>
                        }
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center info-card">
                        Já Zerado Alguma Vez?
                        @if (Model.EverCompleted)
                        {
                            <span class="fw-bold">Sim</span>
                        }
                        else
                        {
                            <span class="fw-bold">Não</span>
                        }
                    </li>
                </ul>
            </div>

            <div class="card">
                <div class="card-header text-center">
                    <h4>Gameplay e DLCs</h4>
                </div>
                <div class="card-body">

                    @if (!hasMedia)
                    {
                        <div class="alert alert-secondary m-0">Nenhum vídeo ou foto de DLC cadastrado.</div>
                    }
                    else
                    {
                        @if (!string.IsNullOrEmpty(videoEmbedUrl))
                        {
                            <h5 class="mb-3">Gameplay</h5>
                            <div class="video-wrapper">
                                <iframe src="@videoEmbedUrl"
                                        frameborder="0"
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                        allowfullscreen>
                                </iframe>
                            </div>
                        }

                        @if (hasDlcs)
                        {
                            <h5 class="mb-3 mt-4">DLCs Completas</h5>
                            <div class="row">
                                @if (!string.IsNullOrEmpty(Model.DlcUrl1))
                                {
                                    <div class="col-md-6 col-lg-3">
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal"
                                           onclick="showImageInModal('@Model.DlcUrl1')">
                                            <img src="@Model.DlcUrl1" alt="DLC 1" class="dlc-image" />
                                        </a>
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(Model.DlcUrl2))
                                {
                                    <div class="col-md-6 col-lg-3">
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal"
                                           onclick="showImageInModal('@Model.DlcUrl2')">
                                            <img src="@Model.DlcUrl2" alt="DLC 2" class="dlc-image" />
                                        </a>
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(Model.DlcUrl3))
                                {
                                    <div class="col-md-6 col-lg-3">
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal"
                                           onclick="showImageInModal('@Model.DlcUrl3')">
                                            <img src="@Model.DlcUrl3" alt="DLC 3" class="dlc-image" />
                                        </a>
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(Model.DlcUrl4))
                                {
                                    <div class="col-md-6 col-lg-3">
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal"
                                           onclick="showImageInModal('@Model.DlcUrl4')">
                                            <img src="@Model.DlcUrl4" alt="DLC 4" class="dlc-image" />
                                        </a>
                                    </div>
                                }
                            </div>
                        }
                    }
                </div>
            </div>

        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12 text-center">

            <a asp-action="TelaEdicao" asp-route-id="@Model.Id"
               asp-route-termoBusca="@termoBusca"
               asp-route-sortOrder="@sortOrder"
               asp-route-filtroAno="@filtroAno"
               asp-route-filtroNaoZerados="@filtroNaoZerados"
               class="btn btn-warning btn-lg px-5 me-2">
                Editar
            </a>

            <a asp-action="ListaJogos"
               asp-route-termoBusca="@termoBusca"
               asp-route-sortOrder="@sortOrder"
               asp-route-filtroAno="@filtroAno"
               asp-route-filtroNaoZerados="@filtroNaoZerados"
               class="btn btn-secondary btn-lg px-5">
                Voltar para a Lista
            </a>
        </div>
    </div>

</div>


<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body p-2">
                <img id="modalImage" src="" alt="Imagem Ampliada" class="modal-img" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        function showImageInModal(imageUrl) {
            var modalImg = document.getElementById('modalImage');
            modalImg.src = imageUrl;
        }
    </script>
}